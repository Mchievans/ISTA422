# Entity Framework Core Tutorial Data Access Approach

### Author: Malachi Evans

#### file: EntityFrameWorkCore.md

#### date: May 09, 2019

------------------------------

1. Install the Entity Frame Work Core NuGet package along with the  Entity Framework Core sql server package. 
**Microsoft.EntityFrameworkCore**
**Microsoft.EntityFrameworkCore.SqlServer**

2. Next create a class with properties named  the same names as the columns in your tables. The database I am using is called BoxDB and the tables I am using are LunchBox and MatchBox with the column headers 

---------  

 | LunchId | Food | Drinks |

and 

 | CarId | Make | Model | 
 
 respectively. 

 -------  

class LunchBox

    {
        public int LunchId { get; set; }
        public string Food { get; set; }
        public string Drinks { get; set;}
    }

     class MatchBox
    {
        public int CarId { get; set; }
        public string Make { get; set; }
        public string Model { get; set; }
    }

--------



 3. Next Create a DbContext class. This is used to "talk" to the DB. Use the **using Microsoft.EntityFrameworkCore** statement. 
 It will look like the following 
 
 ------

 using Microsoft.EntityFrameworkCore;

namespace EntityFrameWorkDataAccessApproach
{
    class BoxContext : DbContext 
    {
        public BoxContext(DbContextOptions<BoxContext> options)
                 : base(options) { }

        public DbSet<MatchBox> Matchboxes { get; set; }
        public DbSet<LunchBox> Lunchboxes { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.HasDefaultSchema("dbo");
        }
    }
}

------- 

4. Next create a class to configuring the entities. This will use an Interface built into the EF Core NuGet Package. You will have to create a configuration class for each table in your db. Name them LunchBoxConfiguration and MatchBoxConfiguration. Once the Interface is implemented you can point to the key and set other data conventions using Linq and the built in properties. He I will specify THe key and using Identity for the Id to be generated by SQL. The  using **Microsoft.EntityFrameworkCore;** and
using **Microsoft.EntityFrameworkCore.Metadata.Builders;** statements are necessary. 
EF Core should do all this automatically but this ensures all data conventions can be configured.

------

namespace EntityFrameWorkDataAccessApproach
{
    class MatchBoxConfiguration : IEntityTypeConfiguration<MatchBox>
    {
        public void Configure(EntityTypeBuilder<MatchBox> builder)
        {
            builder.HasKey(mb => mb.CarId);
            builder.Property(mb => mb.CarId).UseSqlServerIdentityColumn();                     
        }
    }
}


namespace EntityFrameWorkDataAccessApproach
{
    class LunchBoxConfiguration : IEntityTypeConfiguration<LunchBox>
    {
        public void Configure(EntityTypeBuilder<LunchBox> builder)
        {
            builder.HasKey(lb => lb.LunchId);
            builder.Property(lb => lb.LunchId).UseSqlServerIdentityColumn();
        }
    }
}

--------

5. Next in the **BoxContext.cs** file we have to add the configuration to the OnModelCreating method we added earlier. 

-----

  protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.HasDefaultSchema("dbo");
            modelBuilder.ApplyConfiguration(new MatchBoxConfiguration());
            modelBuilder.ApplyConfiguration(new LunchBoxConfiguration());
        }

------

6.  Next we will create a constructor in our BoxService class that receives an instance of a object of BoxContext class. The Context object is used to access the DB and the next few methods will make changes in the db.

----

  class BoxService
    {
        private readonly BoxContext context;

        public BoxService(BoxContext Bcontext)
        {
            context = Bcontext;
        }

        public void AddLunchBox(LunchBox lunchBox)
        {
            var addedLunchBoxEntry = context.Lunchboxes.Add(lunchBox);            
            context.SaveChanges();
        }

        public void AddMatchBox(MatchBox matchBox)
        {
            var addedMatchBoxEntry = context.Matchboxes.Add(matchBox);
            context.SaveChanges();
        }
    }

-----

7. Next we add in the startup file add make changes to the Config